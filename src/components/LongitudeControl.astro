---
import MultiInput from './MultiInput.astro'
---

<label id="longitude-control-label" for="longitude-control-input"
  >Longitude</label
>
<MultiInput
  id="longitude-control"
  class="flex space-x-4"
  value="0"
  min="-180"
  max="180"
  step="0.02"
>
  <input id="longitude-control-input" class="w-24" type="number" value="0" />
  <input
    class="w-full"
    type="range"
    value="1"
    aria-labeledby="longitude-control-label"
  />
</MultiInput>

<script>
  import type { MultiInput, InputElement } from '../custom-elements/multi-input'
  import globalContext from '../lib/global'
  import { toFixed } from '../lib/utilities'

  customElements.whenDefined('multi-input').then(() => {
    const longitudeControl = document.getElementById(
      'longitude-control',
    ) as MultiInput

    longitudeControl.addEventListener('input', event => {
      const target = event.target as InputElement | null
      if (!target?.value) return
      const value = Number(longitudeControl.value)
      if (
        isNaN(value) ||
        value < Number(longitudeControl.min) ||
        value > Number(longitudeControl.max)
      ) {
        return
      }
      globalContext.long = value * (Math.PI / 180)
    })

    globalContext.listen('long', event => {
      let { long } = event.detail
      long = long * (180 / Math.PI)
      longitudeControl.value = toFixed(long, 7)
    })
  })
</script>
